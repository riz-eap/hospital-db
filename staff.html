<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MediCore HMS - Staff</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Roboto',sans-serif;background:#121212;color:#fff;display:flex;height:100vh;overflow:hidden;}

    /* Sidebar */
    .sidebar{width:250px;background:#1f1f30;padding:20px;display:flex;flex-direction:column;}
    .sidebar h2{color:#fff;text-align:center;margin-bottom:25px;}
    .sidebar a{display:block;color:#ccc;padding:12px 15px;margin-bottom:8px;text-decoration:none;border-radius:6px;transition:0.3s;}
    .sidebar a.active,.sidebar a:hover{background:#2e2e50;color:#fff;}
    .sidebar button{margin-top:auto;padding:12px;background:#e74c3c;color:#fff;border:none;border-radius:6px;cursor:pointer;transition:0.3s;}
    .sidebar button:hover{background:#c0392b;}

    /* Main content */
    .main{flex:1;padding:25px;overflow-y:auto;}
    .main h2{margin-bottom:20px;color:#fff;}

    /* Form */
    form{margin-bottom:20px;background:#1e1e2f;padding:20px;border-radius:12px;display:flex;flex-wrap:wrap;gap:10px;align-items:center;}
    form input, form select, form button{padding:10px;border:none;border-radius:6px;font-size:14px;}
    form input, form select{flex:1;}
    form button{background:#1abc9c;color:#121212;cursor:pointer;transition:0.3s;font-weight:500;}
    form button:hover{background:#16a085;}

    /* Table */
    table{width:100%;border-collapse:collapse;margin-top:20px;border-radius:10px;overflow:hidden;background:#1f1f30;}
    th, td{padding:12px 15px;text-align:center;border-bottom:1px solid #333;}
    th{background:#2a2a40;color:#fff;font-weight:500;}
    tr:nth-child(even){background:#23233f;}
    tr:hover{background:#2e2e50;}
    td[contenteditable="true"]{background:#2a2a40;cursor:text;}

    /* Action buttons */
    button.action-btn{padding:6px 10px;border:none;border-radius:6px;margin:0 3px;cursor:pointer;transition:0.3s;}
    button.save-btn{background:#1abc9c;color:#121212;}
    button.save-btn:hover{background:#16a085;}
    button.delete-btn{background:#e74c3c;color:#fff;}
    button.delete-btn:hover{background:#c0392b;}
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h2>MediCore HMS</h2>
    <a href="/index.html">Dashboard</a>
    <a href="/patients.html">Patients</a>
    <a href="/staff.html" class="active">Staff</a>
    <a href="/appointments.html">Appointments</a>
    <a href="/medicines.html">Medicines</a>
    <a href="/settings.html">Settings</a>
    <button onclick="logout()">Logout</button>
  </div>

  <!-- Main Content -->
  <div class="main">
    <h2>Staff</h2>
    <form id="add-staff-form">
      <input type="text" id="name" placeholder="Name" required>
      <input type="text" id="role" placeholder="Role" required>
      <input type="text" id="department" placeholder="Department">
      <input type="text" id="shift" placeholder="Shift">
      <select id="status"><option>available</option><option>busy</option></select>
      <button type="submit">Add Staff</button>
    </form>

    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>Role</th>
          <th>Department</th>
          <th>Shift</th>
          <th>Status</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="staff-tbody"></tbody>
    </table>
  </div>

  <script>
    const user = JSON.parse(localStorage.getItem('user'));
    if(!user) window.location.href='/login.html';

    function logout(){
      fetch('/logout',{method:'POST'}).finally(()=>{
        localStorage.removeItem('user');
        window.location.href='/login.html';
      });
    }

    async function loadStaff(){
      try{
        const data = await fetch('/staff').then(r=>r.json());
        const tbody = document.getElementById('staff-tbody'); tbody.innerHTML='';
        data.forEach(s=>{
          tbody.innerHTML+=`
            <tr>
              <td>${s.id}</td>
              <td contenteditable="true" data-field="name">${s.name}</td>
              <td contenteditable="true" data-field="role">${s.role}</td>
              <td contenteditable="true" data-field="department">${s.department||''}</td>
              <td contenteditable="true" data-field="shift">${s.shift||''}</td>
              <td contenteditable="true" data-field="status">${s.status}</td>
              <td>
                <button class="action-btn save-btn" onclick="updateStaff(${s.id}, this)">Save</button>
                <button class="action-btn delete-btn" onclick="deleteStaff(${s.id})">Delete</button>
              </td>
            </tr>`;
        });
      } catch(err){ console.error('Error loading staff', err); }
    }

    async function updateStaff(id,btn){
      const row = btn.closest('tr');
      const body = {
        name: row.querySelector('[data-field="name"]').innerText,
        role: row.querySelector('[data-field="role"]').innerText,
        department: row.querySelector('[data-field="department"]').innerText,
        shift: row.querySelector('[data-field="shift"]').innerText,
        status: row.querySelector('[data-field="status"]').innerText
      };
      await fetch(`/staff/${id}`, {method:'PUT', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
      loadStaff();
    }

    async function deleteStaff(id){
      if(!confirm('Delete staff?')) return;
      await fetch(`/staff/${id}`, {method:'DELETE'});
      loadStaff();
    }

    document.getElementById('add-staff-form').addEventListener('submit', async e=>{
      e.preventDefault();
      const body = {
        name: name.value,
        role: role.value,
        department: department.value,
        shift: shift.value,
        status: status.value
      };
      await fetch('/staff/add', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(body)});
      loadStaff(); e.target.reset();
    });

    window.onload = loadStaff;
  </script>
</body>
</html>
